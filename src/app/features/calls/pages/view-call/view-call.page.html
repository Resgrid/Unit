<ion-content fullscreen="true">
  <ion-fab vertical="top" horizontal="end" slot="fixed">
    <ion-fab-button size="small" color="light" (click)="dismissModal()">
      <ion-icon name="close-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <div class="ion-padding" *ngIf="(callsState$ | async)?.viewCallType === 'call'">
    <article>
      <div class="callL1t">
        <div>
          <h5>
            {{(callsState$ | async)?.callToView?.Name}}
          </h5>
          <p [innerHTML]="(callsState$ | async)?.callToView?.Nature"></p>
        </div>
      </div>
      <div style="height: 200px !important; width: 100% !important; overflow: hidden;"
        *ngIf="(callsState$ | async)?.callToView?.Geolocation != null || (callsState$ | async)?.callToView?.Geolocation?.length > 0">
        <div #viewCallMap id="viewCallMap" name="viewCallMap" data-tap-disabled="true"
          style="height: 200px !important; width: 100% !important; overflow: hidden; pointer-events: none; touch-action: none;"></div>
      </div>
      <ion-grid class="button-group">
        <ion-row>
          <ion-col style="padding-left: 0px; padding-right: 0px; margin-left: 0px; margin-right: 0px;">
            <ion-button expand="full" color="primary" (click)="navCallNotes()">{{'callDetailPage.notesButton' | translate}}
              <ion-badge color="primary" class="notifications-badge">{{getNoteCount((callsState$ | async).callToView)}}</ion-badge>
            </ion-button>
          </ion-col>
          <ion-col style="padding-left: 0px; padding-right: 0px; margin-left: 0px; margin-right: 0px;">
            <ion-button expand="full" color="primary" (click)="navCallImages()">{{'callDetailPage.imagesButton' | translate}}
              <ion-badge color="primary" class="notifications-badge">{{getImagesCount((callsState$ | async).callToView)}}</ion-badge>
            </ion-button>
          </ion-col>
          <ion-col style="padding-left: 0px; padding-right: 0px; margin-left: 0px; margin-right: 0px;">
            <ion-button expand="full" color="primary" (click)="navCallFiles()">{{'callDetailPage.filesButton' | translate}}
              <ion-badge color="primary" class="notifications-badge">{{getFilesCount((callsState$ | async).callToView)}}</ion-badge>
            </ion-button>
          </ion-col>
          <ion-col style="padding-left: 0px; padding-right: 0px; margin-left: 0px; margin-right: 0px;"
          *ngIf="(callsState$ | async)?.callToView?.Geolocation != null && (callsState$ | async)?.callToView?.Geolocation?.length > 0">
            <ion-button expand="full" color="secondary" (click)="route()">{{'callDetailPage.routeButton' | translate}}</ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
      <div *ngIf="(callsState$ | async)?.callToView?.AudioFileId?.length > 0" style="width: 100%; text-align: center;">
        <audio controls src="{{getDispatchUrl((callsState$ | async)?.callToView?.AudioFileId)}}" type="audio/mpeg">
        </audio>
      </div>
      <div padding>
        <ion-segment [(ngModel)]="tabType" scrollable="true">
          <ion-segment-button value="data">
            {{'callDetailPage.dataTab' | translate}}
          </ion-segment-button>
          <ion-segment-button value="contact">
            {{'callDetailPage.contactTab' | translate}}
          </ion-segment-button>
          <ion-segment-button value="protocols">
            {{'callDetailPage.protocolsTab' | translate}}
          </ion-segment-button>
          <ion-segment-button value="dispatch">
            {{'callDetailPage.dispatchTab' | translate}}
          </ion-segment-button>
          <ion-segment-button value="activity">
            {{'callDetailPage.activityTab' | translate}}
          </ion-segment-button>
        </ion-segment>
      </div>

      <div [ngSwitch]="tabType" style="overflow-y: auto;">
        <ion-list *ngSwitchCase="'data'">
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.dataTabPriority' | translate}}</h2>
              <p [style.color]="(callsState$ | async)?.callToViewPriority?.Color">{{(callsState$ | async)?.callToViewPriority?.Name}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.dataTabTimestamp' | translate}}</h2>
              <p>{{getFullDateTime((callsState$ | async)?.callToView?.LoggedOnUtc)}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.dataTabType' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.Type}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.dataTabAddress' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.Address}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label class="ion-text-wrap">
              <h2>{{'callDetailPage.dataTabNotes' | translate}}</h2>
              <p [innerHtml]="(callsState$ | async)?.callToView?.Note"></p>
            </ion-label>
          </ion-item>
        </ion-list>

        <ion-list *ngSwitchCase="'contact'">
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.contactTabReferenceId' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.ReferenceId}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.contactTabExternalId' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.ExternalId}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.contactTabContactName' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.ContactName}}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{'callDetailPage.contactTabContactInfo' | translate}}</h2>
              <p>{{(callsState$ | async)?.callToView?.ContactInfo}}</p>
            </ion-label>
          </ion-item>
        </ion-list>

        <ion-list *ngSwitchCase="'protocols'">
          <ion-item *ngFor="let protocol of (callsState$ | async)?.callViewData?.Protocols">
            <h4>{{protocol.Name}} ({{protocol.Code}})</h4>
            <p>{{protocol.Description}}</p>
            <p>{{protocol.ProtocolText}}</p>
          </ion-item>
        </ion-list>

        <ion-list *ngSwitchCase="'dispatch'">
          <ion-item *ngFor="let dispatch of (callsState$ | async)?.callViewData?.Dispatches">
            <ion-label>
              <h2>{{dispatch.Name}}</h2>
              <p>{{dispatch.Group}} ({{dispatch.Type}})</p>
            </ion-label>
          </ion-item>
        </ion-list>

        <div *ngSwitchCase="'activity'" style="overflow-y: auto;">
          <ion-list>
            <ion-item *ngFor="let activity of (callsState$ | async)?.callViewData?.Activity  | orderBy : '-Timestamp'">
              <ion-label class="ion-text-wrap">
                <ion-text color="primary">
                  <h3>{{activity.Name}} ({{activity.Group}})</h3>
                </ion-text>
                <p><span [style.color]="activity.StatusColor">{{activity.StatusText}}</span> {{formatTimestamp(activity.Timestamp)}}</p>
                <ion-text color="secondary">
                  <h3>{{activity.Note}}</h3>
                </ion-text>
              </ion-label>
            </ion-item>
          </ion-list>
        </div>
      </div>
    </article>
  </div>
  <div style="margin-top: 5px; height: 84vh;" *ngIf="(callsState$ | async)?.viewCallType === 'notes'">
    <span>
      <h3 style="padding-left: 10px;">{{'callDetailPage.callNotes' | translate}}</h3>
    </span>
    <div class="ion-padding" style="height: 94%;">
      <perfect-scrollbar>
        <div *ngIf="!(callsState$ | async).callNotes || (callsState$ | async).callNotes.length <= 0">
          <cta-panel [topIcon]="'information-circle'" [title]="'callNotesPage.ctaPanel.title' | translate" [details]="'callNotesPage.ctaPanel.details' | translate"
            [extraDetails]="'callNotesPage.ctaPanel.extraDetails' | translate" [btnLabel]="'callNotesPage.ctaPanel.buttonLabel' | translate" [hideButton]="true"></cta-panel>
        </div>
        <div class="list_div" *ngFor="let note of (callsState$ | async).callNotes;">
          <div class="user_image bg_image" [style.background-image]="'url(' + (getAvatarUrl(note.UserId)) + ')'"></div>
          <div class="detail">
            <ion-label class="username">{{note.FullName}}</ion-label>
            <span>
              <ion-label class="light">{{note.Note}}</ion-label>
              <ion-label class="time">{{note.TimestampFormatted}}</ion-label>
            </span>
          </div>
        </div>
      </perfect-scrollbar>
    </div>
    <div style="display: inherit;" class="footer_div">
      <form (ngSubmit)="saveNote()" [formGroup]="callNotesFormData">
        <ion-grid>
          <ion-row>
            <ion-col size="10" size-lg>
              <ion-input type="text" placeholder="{{'callDetailPage.enterNoteLabel' | translate}}" formControlName="message" [ngClass]="{'is-invalid': isSavingNote && callNotesFormData.errors}">
              </ion-input>
            </ion-col>
            <ion-col size="2" size-sm>
              <ion-button type="submit">
                <ion-icon name="save-outline"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid>
      </form>
    </div>
  </div>
  <div style="margin-top: 5px; height: 84vh;" *ngIf="(callsState$ | async)?.viewCallType === 'images'">
    <span>
      <h3 style="padding-left: 10px;">{{'callDetailPage.callImages' | translate}}</h3>
    </span>
    <div class="ion-padding" style="height: 94%;" *ngIf="!images || images.length <= 0">
      <cta-panel [topIcon]="'information-circle'" [title]="'callImagesPage.ctaPanel.title' | translate" [details]="'callImagesPage.ctaPanel.details' | translate"
        [extraDetails]="'callImagesPage.ctaPanel.extraDetails' | translate" [btnLabel]="'callImagesPage.ctaPanel.buttonLabel' | translate" [hideButton]="true"></cta-panel>
    </div>
    <div class="ion-padding" style="height: 94%;overflow-y: hidden;" *ngIf="images && images.length > 0">
      <gallery id="mixedExample" [items]="images"></gallery>
    </div>
    <div style="display: inherit;" class="footer_div">
      <ion-grid>
        <ion-row>
          <ion-col>
            <ion-input type="text" placeholder="{{'callDetailPage.imageNoteLabel' | translate}}" [(ngModel)]="imageNote"></ion-input>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col style="text-align: center;">
            <ion-button (click)="uploadPhoto()">{{'callDetailPage.uploadPhotoButton' | translate}}</ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </div>
  <div class="ion-padding" style="margin-top: 5px; height: 84vh;" *ngIf="(callsState$ | async)?.viewCallType === 'files'">
    <span>
      <h3 style="padding-left: 10px;">{{'callDetailPage.callFiles' | translate}}</h3>
    </span>
    <div class="ion-padding" style="height: 94%;" *ngIf="!(callsState$ | async).callFiles || (callsState$ | async).callFiles.length <= 0">
      <cta-panel [topIcon]="'information-circle'" [title]="'callFilesPage.ctaPanel.title' | translate" [details]="'callFilesPage.ctaPanel.details' | translate"
        [extraDetails]="'callFilesPage.ctaPanel.extraDetails' | translate" [btnLabel]="'callFilesPage.ctaPanel.buttonLabel' | translate" [hideButton]="true"></cta-panel>
    </div>
    <div class="ion-padding" style="height: 94%;" *ngIf="(callsState$ | async).callFiles && (callsState$ | async).callFiles.length > 0">
      <perfect-scrollbar>
        <ion-list>
          <ion-item *ngFor="let file of (callsState$ | async).callFiles;" (click)="openFile(file)">
            <div style="height: 40px;">
              <div class="personnel-information">
                <h3 style="word-wrap: break-word; font-weight: bold;">
                  {{file.Name}}
                </h3>
              </div>
            </div>
            <div style="font-size: 12px; float: left; width: 100%;">
              <span>{{file.FileName}}</span>
            </div>
          </ion-item>
        </ion-list>
      </perfect-scrollbar>
    </div>
    <div style="display: inherit;" class="footer_div">
      <form (ngSubmit)="uploadFile()" [formGroup]="callNotesFormData">
        <ion-grid>
          <ion-row>
            <ion-col size="11">

            </ion-col>
            <ion-col>

            </ion-col>
          </ion-row>
        </ion-grid>
      </form>
    </div>
  </div>
</ion-content>
